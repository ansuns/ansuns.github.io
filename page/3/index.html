<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="阿深">
<meta name="keywords" content="阿深">
<meta property="og:type" content="website">
<meta property="og:title" content="阿深">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="阿深">
<meta property="og:description" content="阿深">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="阿深">
<meta name="twitter:description" content="阿深">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/">





  <title>阿深</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">阿深</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">阿深</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-life">
          <a href="/life" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-life-buoy"></i> <br>
            
            生活
          </a>
        </li>
      
        
        <li class="menu-item menu-item-photo">
          <a href="/photo" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-photo"></i> <br>
            
            图片
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/bf4ad76b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/bf4ad76b/" itemprop="url">mysql：相关优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-21T13:55:49+08:00">
                2016-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="1-如何查看sql语句执行效率？"><a href="#1-如何查看sql语句执行效率？" class="headerlink" title="1. 如何查看sql语句执行效率？"></a>1. 如何查看sql语句执行效率？</h5><p>使用explain函数 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>或者开启 慢查询<br>是否开启</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%quer%'</span>;</span><br></pre></td></tr></table></figure>

<p>log_slow_queries=off 没有开启慢查询<br>long_query_time 就是慢查询时间，sql语句超过这个时间会生成日志？一般来说超过3秒就算慢了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/264386d1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/264386d1/" itemprop="url">mysql：PHP连接Mysql单例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-29T15:05:42+08:00">
                2015-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> $_instance;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> $_connectSource;</span><br><span class="line">    <span class="keyword">private</span> $_dbConfig = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'host'</span> =&gt; <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'user'</span> =&gt; <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'password'</span> =&gt; <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'database'</span> =&gt; <span class="string">'thinkphp'</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">self</span>::$_instance = <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>::$_instance <span class="keyword">instanceof</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>::$_instance = <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$_instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">self</span>::$_connectSource) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>::$_connectSource = mysql_connect(<span class="keyword">$this</span>-&gt;_dbConfig[<span class="string">'host'</span>], <span class="keyword">$this</span>-&gt;_dbConfig[<span class="string">'user'</span>], <span class="keyword">$this</span>-&gt;_dbConfig[<span class="string">'password'</span>]);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">self</span>::$_connectSource) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'mysql error: '</span> . mysql_error());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mysql_select_db(<span class="keyword">$this</span>-&gt;_dbConfig[<span class="string">'database'</span>], <span class="keyword">self</span>::$_connectSource);</span><br><span class="line">            mysql_query(<span class="string">"set names utf8"</span>, <span class="keyword">self</span>::$_connectSource);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$_connectSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$connect = Db::getInstance()-&gt;connect();</span><br><span class="line">$sql = <span class="string">"select * from tp_users"</span>;</span><br><span class="line">$res = mysql_query($sql, $connect);</span><br><span class="line">$arr = <span class="keyword">array</span>(); <span class="comment">//空数组</span></span><br><span class="line"><span class="keyword">while</span> ($rec = mysql_fetch_assoc($res)) &#123;</span><br><span class="line">    $arr[] = $rec;<span class="comment">//这样就形成二维数组</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span> . print_r($arr, <span class="number">1</span>) . <span class="string">"&lt;/pre&gt;"</span>;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/b1c887f1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/b1c887f1/" itemprop="url">Memcached服务端自动启动</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-28T12:56:01+08:00">
                2015-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/Nosql/" itemprop="url" rel="index">
                    <span itemprop="name">Nosql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>经测试，要使得Memcached能够提供session共享服务，必须启动Memcached服务端为系统服务。本人较为初级，一般都是按向导安装的。</p>
<p>所以，要将其设为自动启动的服务也就困难了。<br>上网搜索了一下，结果，得到以下一些结果，做个记录：</p>
<h5 id="1、最傻的做法"><a href="#1、最傻的做法" class="headerlink" title="1、最傻的做法"></a>1、最傻的做法</h5><p>通常：启动Memcache的服务器端的命令为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/local/bin/memcached -d -m 10 -u root -l 192.168.0.200 -p 12000 -c 256 -P /tmp/memcached.pid</span></span><br></pre></td></tr></table></figure>

<p>-d选项是启动一个守护进程，<br>-m是分配给Memcache使用的内存数量，单位是MB，我这里是10MB，<br>-u是运行Memcache的用户，我这里是root，<br>-l是监听的服务器IP地址，如果有多个地址的话，我这里指定了服务器的IP地址192.168.0.200，<br>-p是设置Memcache监听的端口，我这里设置了12000，最好是1024以上的端口，<br>-c选项是最大运行的并发连接数，默认是1024，我这里设置了256，按照你服务器的负载量来设定，<br>-P是设置保存Memcache的pid文件，我这里是保存在 /tmp/memcached.pid，<br>想开机自动启动的话，只需在/etc/rc.d/rc.local中加入一行，上面命令<br>有人用以下命令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/memcached/bin/memcached -d -m <span class="number">20</span> -p <span class="number">11211</span> -u apache</span><br></pre></td></tr></table></figure>

<p>上面有些东西可以参考一下：即，ip不指定时，默认是本机，用户，最好选择是：apache 或 deamon<br>这样，也就是属于哪个用户的服务，由哪个用户启动。</p>
<h5 id="2、较正规的方法："><a href="#2、较正规的方法：" class="headerlink" title="2、较正规的方法："></a>2、较正规的方法：</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">To add a service to chkconfig you will normally need a couple of special comments below the shebang of a shell script:</span><br><span class="line"><span class="comment">#!/bin/sh   </span></span><br><span class="line"><span class="comment"># chkconfig: - 55 45  </span></span><br><span class="line"><span class="comment"># description:  The memcached daemon is a network memory cache service.   </span></span><br><span class="line"><span class="comment"># processname: memcached  </span></span><br><span class="line"></span><br><span class="line">After adding the lines to /etc/init.d/memcached you can then issue</span><br><span class="line">chkconfig --add memcached</span><br><span class="line">There are of course additional run levels a process can start at so to check that you would issue</span><br><span class="line">chkconfig --<span class="keyword">list</span> | grep <span class="string">"memcached"</span></span><br><span class="line">A common run level <span class="keyword">for</span> memcached would be</span><br><span class="line">chkconfig --level <span class="number">345</span> memcached on</span><br></pre></td></tr></table></figure>

<p>说明：chkconfig –add memcached 用来添加memcached服务<br>chkconfig –list | grep “memcached” 检查服务是否添加<br>还可以简写为这样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig  --list | grep mem</span><br><span class="line">```bash</span><br><span class="line">chkconfig --level 345 memcached on</span><br></pre></td></tr></table></figure>

<p>设置运行级别。<br>建议：最好使用chkconfig –level 235 memcached on 这样的话与apache级别相同，即只要有apache，就有memcached<br>3、更复杂的做法，创建完美的启动脚本<br>网上找到以下两个脚本：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh   </span></span><br><span class="line"><span class="comment">#   </span></span><br><span class="line"><span class="comment"># memcached:    MemCached Daemon   </span></span><br><span class="line"><span class="comment">#   </span></span><br><span class="line"><span class="comment"># chkconfig:    - 90 25  </span></span><br><span class="line"><span class="comment"># description:  MemCached Daemon   </span></span><br><span class="line"><span class="comment">#   </span></span><br><span class="line"><span class="comment"># Source function library.   </span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span>   </span><br><span class="line">. /etc/sysconfig/network   </span><br><span class="line"><span class="comment">#[ $&#123;NETWORKING&#125; = "no" ] &amp;&amp; exit 0  </span></span><br><span class="line"><span class="comment">#[ -r /etc/sysconfig/dund ] || exit 0  </span></span><br><span class="line"><span class="comment">#. /etc/sysconfig/dund   </span></span><br><span class="line"><span class="comment">#[ -z "$DUNDARGS" ] &amp;&amp; exit 0  </span></span><br><span class="line">start()   </span><br><span class="line">&#123;   </span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">"Starting memcached: "</span>  </span><br><span class="line">        daemon <span class="variable">$MEMCACHED</span> -u daemon -d -m 1024 -l 127.0.0.1 -p 11211  </span><br><span class="line">        <span class="built_in">echo</span>   </span><br><span class="line">&#125;   </span><br><span class="line">stop()   </span><br><span class="line">&#123;   </span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">"Shutting down memcached: "</span>  </span><br><span class="line">        killproc memcached   </span><br><span class="line">        <span class="built_in">echo</span>   </span><br><span class="line">&#125;   </span><br><span class="line">MEMCACHED=<span class="string">"/usr/local/memcached/bin/memcached"</span>  </span><br><span class="line">[ -f <span class="variable">$MEMCACHED</span> ] || <span class="built_in">exit</span> 1  </span><br><span class="line"><span class="comment"># See how we were called.   </span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span>   </span><br><span class="line">  start)   </span><br><span class="line">        start   </span><br><span class="line">        ;;   </span><br><span class="line">  stop)   </span><br><span class="line">        stop   </span><br><span class="line">        ;;   </span><br><span class="line">  restart)   </span><br><span class="line">        stop   </span><br><span class="line">        sleep 3  </span><br><span class="line">        start   </span><br><span class="line">        ;;   </span><br><span class="line">    *)   </span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|restart&#125;"</span>  </span><br><span class="line">        <span class="built_in">exit</span> 1  </span><br><span class="line"><span class="keyword">esac</span>   </span><br><span class="line"><span class="built_in">exit</span> 0  </span><br><span class="line">  </span><br><span class="line"><span class="meta">#!/bin/sh   </span></span><br><span class="line"><span class="comment">#   </span></span><br><span class="line"><span class="comment"># memcached:    MemCached Daemon   </span></span><br><span class="line"><span class="comment">#   </span></span><br><span class="line"><span class="comment"># chkconfig:    - 90 25    </span></span><br><span class="line"><span class="comment"># description:  MemCached Daemon   </span></span><br><span class="line"><span class="comment">#   </span></span><br><span class="line"><span class="comment"># Source function library.   </span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span>   </span><br><span class="line">. /etc/sysconfig/network   </span><br><span class="line">    </span><br><span class="line">start()    </span><br><span class="line">&#123;   </span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">"Starting memcached: "</span>  </span><br><span class="line">        daemon /usr/<span class="built_in">local</span>/bin/memcached -u daemon -d -m 4096 -l 10.10.10.220 -p 58728  </span><br><span class="line">        <span class="built_in">echo</span>   </span><br><span class="line">&#125;   </span><br><span class="line">    </span><br><span class="line">stop()    </span><br><span class="line">&#123;   </span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">"Shutting down memcached: "</span>  </span><br><span class="line">        killproc memcached    </span><br><span class="line">        <span class="built_in">echo</span>   </span><br><span class="line">&#125;   </span><br><span class="line">    </span><br><span class="line">[ -f /usr/<span class="built_in">local</span>/bin/memcached ] || <span class="built_in">exit</span> 0  </span><br><span class="line">    </span><br><span class="line"><span class="comment"># See how we were called.   </span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span>   </span><br><span class="line">  start)   </span><br><span class="line">        start   </span><br><span class="line">        ;;   </span><br><span class="line">  stop)   </span><br><span class="line">        stop   </span><br><span class="line">        ;;   </span><br><span class="line">  restart|reload)   </span><br><span class="line">        stop   </span><br><span class="line">        start   </span><br><span class="line">        ;;   </span><br><span class="line">  condrestart)   </span><br><span class="line">        stop   </span><br><span class="line">        start   </span><br><span class="line">        ;;   </span><br><span class="line">  *)   </span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|restart|reload|condrestart&#125;"</span>  </span><br><span class="line">        <span class="built_in">exit</span> 1  </span><br><span class="line"><span class="keyword">esac</span>   </span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<p>在上述指定目录创建了上述某一个脚本以后，就可以进行以下操作：<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@crm ~]<span class="comment"># chkconfig  --add memcached </span></span><br><span class="line">[root@crm ~]<span class="comment"># chkconfig  --level 235  memcached  on</span></span><br><span class="line">[root@crm ~]<span class="comment"># chkconfig  --list | grep mem</span></span><br><span class="line">memcached       0:off   1:off   2:on   3:on    4:off   5:on   6:off</span><br></pre></td></tr></table></figure></p>
<p>接下来，可以用以下命令启动与停止 memcached</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/rc.d/init.d/memcached  start  </span><br><span class="line">/etc/rc.d/init.d/memcached  stop</span><br><span class="line">/etc/rc.d/init.d/memcached  restart</span><br></pre></td></tr></table></figure>

<p>如： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@crm ~]<span class="comment"># /etc/rc.d/init.d/memcached  restart</span></span><br><span class="line">Shutting down memcached: [  OK  ]</span><br><span class="line">Starting memcached:      [  OK  ]</span><br></pre></td></tr></table></figure>

<p>同时，还可以用：<br>service memcached start<br>这样的命令操作<br>然后，可以用ps命令查看进程信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@crm ~]<span class="comment"># ps aux | grep mem</span></span><br><span class="line">daemon   23781  0.0  0.2 13892 9860 ?  Ss 16:51:00  /.../memcached -u daemon -d -m 1024 -l 172.16.0.106 -p 11211</span><br></pre></td></tr></table></figure>

<p>以上两个脚本前一个脚本中，对网络进行检查。其它都是针对服务启动与停止的命令提示设置。<br>有人说，复杂的脚本并不好懂，自己也不会写，却想要更完善的，怎么办？<br>那就到网上找高手的。最好的捷径就是到对应的RPM包中去找。（如果直接用RPM包安装，这些事情都不用做了）<br>当然，memcached多数情况下都是编译安装，因为，很多时候都是找不到对应的版本。<br>脚本中 # chkconfig: - 55 45 运行级别这一列参数用的是 -，这样，是不在脚本中写死，可以通过 chkconfig  –level 235  memcached  on 灵活设置。<br>最后就是，目前仍不了解</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">. /etc/sysconfig/network</span><br><span class="line"><span class="comment">#[ $&#123;NETWORKING&#125; = "no" ] &amp;&amp; exit 0</span></span><br><span class="line"><span class="comment">#[ -r /etc/sysconfig/dund ] || exit 0</span></span><br><span class="line"><span class="comment">#. /etc/sysconfig/dund</span></span><br><span class="line"><span class="comment">#[ -z "$DUNDARGS" ] &amp;&amp; exit 0</span></span><br></pre></td></tr></table></figure>

<p>这一段的详细含义。需要进一步学习！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/cc768ab3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/cc768ab3/" itemprop="url">memcached操作类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-27T22:14:51+08:00">
                2015-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memcached</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $type = <span class="string">'Memcached'</span>;</span><br><span class="line">    <span class="keyword">private</span> $m;</span><br><span class="line">    <span class="keyword">private</span> $time = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> $error;</span><br><span class="line">    <span class="keyword">private</span> $debug = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!class_exists(<span class="keyword">$this</span>-&gt;type)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;error = <span class="string">'No '</span> . <span class="keyword">$this</span>-&gt;type;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;m = <span class="keyword">new</span> <span class="keyword">$this</span>-&gt;type;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addServers</span><span class="params">($arr)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;m-&gt;addServers($arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">s</span><span class="params">($key, $value = <span class="string">''</span>, $time = <span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $num = func_num_args();</span><br><span class="line">        <span class="keyword">if</span> ($num == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($num &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($value === <span class="keyword">NULL</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;delete($key);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;set($key, $value, $time);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span><span class="params">($key, $value, $time = NULL)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($time === <span class="keyword">NULL</span>) &#123;</span><br><span class="line">            $time = <span class="keyword">$this</span>-&gt;time;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;m-&gt;set($key, $value, $time);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;m-&gt;getResultCode() != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;m-&gt;delete($key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $return = <span class="keyword">$this</span>-&gt;m-&gt;get($key);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;m-&gt;getResultCode() != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addServer</span><span class="params">($arr)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;m-&gt;addServers($arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getError</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;error) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;m-&gt;getResultMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/bb47fb28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/bb47fb28/" itemprop="url">centos下memcached安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-27T19:56:14+08:00">
                2015-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/Nosql/" itemprop="url" rel="index">
                    <span itemprop="name">Nosql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="1-使用yum-install-命令安装memcached"><a href="#1-使用yum-install-命令安装memcached" class="headerlink" title="1. 使用yum install 命令安装memcached"></a>1. 使用yum install 命令安装memcached</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install memcached</span><br><span class="line"> /usr/bin/memcached -d -l 127.0.0.1 -p 11211 -m 150 -u root</span><br></pre></td></tr></table></figure>

<p>-d守护进程 -l服务器地址 -p端口号 -m分配内存 -u已root用户启动</p>
<h5 id="2-Memcached客户端安装"><a href="#2-Memcached客户端安装" class="headerlink" title="2. Memcached客户端安装"></a>2. Memcached客户端安装</h5><ul>
<li>安装   Libmemcached</li>
<li>为PHP安装 Memcached扩展<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://launchpad.net/libmemcached/1.0/1.0.9/+download/libmemcached-1.0.9.tar.gz</span><br><span class="line">ibmemcached</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>#/usr/lib/libmemcached 安装在这个目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> ./configure --prefix=/usr/lib/libmemcached</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="3-安装-Memcached扩展"><a href="#3-安装-Memcached扩展" class="headerlink" title="3. 安装 Memcached扩展"></a>3. 安装 Memcached扩展</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http://pecl.php.net/get/memcached-2.2.0.tgz</span><br><span class="line">tar zxvf memcached-2.2.0.tgz </span><br><span class="line"><span class="built_in">cd</span> memcached-2.2.0</span><br><span class="line">phpize</span><br><span class="line"> ./configure --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config</span><br></pre></td></tr></table></figure>

<ul>
<li>出现错误<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">checking for libmemcached location... configure: error: memcached support requires libmemcached.</span><br><span class="line"> Use --with-libmemcached-dir=&lt;DIR&gt; to specify the prefix where libmemcached headers and library are located</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="4-指定libmemcache安装目录"><a href="#4-指定libmemcache安装目录" class="headerlink" title="4. 指定libmemcache安装目录"></a>4. 指定libmemcache安装目录</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config --with-libmemcached-dir=/usr/lib/libmemcached/</span><br></pre></td></tr></table></figure>

<h5 id="5-又出现一个错误"><a href="#5-又出现一个错误" class="headerlink" title="5. 又出现一个错误"></a>5. 又出现一个错误</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">checking for sasl/sasl.h... no</span><br><span class="line">configure: error: no, sasl.h is not available. Run configure with --disable-memcached-sasl to disable this check</span><br><span class="line">[root@ansuns memcached-2.2.0]#</span><br></pre></td></tr></table></figure>

<p>解决</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config --with-libmemcached-dir=/usr/lib/libmemcached/ --<span class="built_in">disable</span>-memcached-sasl</span><br></pre></td></tr></table></figure>

<p>1继续..</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>安装成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">If you ever happen to want to link against installed libraries</span><br><span class="line"><span class="keyword">in</span> a given directory, LIBDIR, you must either use libtool, and</span><br><span class="line">specify the full pathname of the library, or use the `-LLIBDIR<span class="string">'</span></span><br><span class="line"><span class="string">flag during linking and do at least one of the following:</span></span><br><span class="line"><span class="string">   - add LIBDIR to the `LD_LIBRARY_PATH'</span> environment variable</span><br><span class="line">     during execution</span><br><span class="line">   - add LIBDIR to the `LD_RUN_PATH<span class="string">' environment variable</span></span><br><span class="line"><span class="string">     during linking</span></span><br><span class="line"><span class="string">   - use the `-Wl,--rpath -Wl,LIBDIR'</span> linker flag</span><br><span class="line">   - have your system administrator add LIBDIR to `/etc/ld.so.conf<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">See any operating system documentation about shared libraries for</span></span><br><span class="line"><span class="string">more information, such as the ld(1) and ld.so(8) manual pages.</span></span><br><span class="line"><span class="string">----------------------------------------------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Build complete.</span></span><br><span class="line"><span class="string">Don'</span>t forget to run <span class="string">'make test'</span>.</span><br><span class="line">-----------------------------------------</span><br></pre></td></tr></table></figure>

<p>扩展安装完成</p>
<p>扩展目录<br> /usr/local/php/lib/php/extensions/no-debug-non-zts-20121212/</p>
<p>接着把扩展加到PHP里边</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/php/etc/php.ini</span><br><span class="line">extension=memcached.so</span><br><span class="line">wq</span><br></pre></td></tr></table></figure>

<p>重启<br>查看有没有加载扩展</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -m | grep memcached</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$memcached = <span class="keyword">new</span> memcached();</span><br><span class="line">$memcached-&gt;addServers(<span class="string">'192.168.18.88'</span>,<span class="number">11211</span>);</span><br><span class="line">$memcached-&gt;add(<span class="string">'key'</span>,<span class="string">'value'</span>);</span><br><span class="line"><span class="keyword">echo</span> $memcached-&gt;get(<span class="string">'key'</span>);</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/e7812f0a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/e7812f0a/" itemprop="url">windows下SVN服务搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-25T00:44:22+08:00">
                2015-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/版本控制/" itemprop="url" rel="index">
                    <span itemprop="name">版本控制</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-基础"><a href="#1-基础" class="headerlink" title="1. 基础"></a>1. 基础</h4><h4 id="1-1-安装服务端，安装客户端（小乌龟。。。）"><a href="#1-1-安装服务端，安装客户端（小乌龟。。。）" class="headerlink" title="1.1. 安装服务端，安装客户端（小乌龟。。。）"></a>1.1. 安装服务端，安装客户端（小乌龟。。。）</h4><h4 id="1-2-建立仓库：svnadmin-create-f-web-shop"><a href="#1-2-建立仓库：svnadmin-create-f-web-shop" class="headerlink" title="1.2. 建立仓库：svnadmin create f:\web\shop"></a>1.2. 建立仓库：svnadmin create f:\web\shop</h4><h4 id="1-3-启动仓库-svnserve-d-r-f-web-shop"><a href="#1-3-启动仓库-svnserve-d-r-f-web-shop" class="headerlink" title="1.3. 启动仓库 svnserve -d -r f:\web\shop"></a>1.3. 启动仓库 svnserve -d -r f:\web\shop</h4><h4 id="1-4-shop-conf-svnserve-conf-约-12行"><a href="#1-4-shop-conf-svnserve-conf-约-12行" class="headerlink" title="1.4. shop\conf\svnserve.conf 约 12行"></a>1.4. shop\conf\svnserve.conf 约 12行</h4><p>#anon-access = read 修改为 anon-access = write （前面不能含空格）意思是允许匿名提交 #### </p>
<h4 id="1-5-checkout…"><a href="#1-5-checkout…" class="headerlink" title="1.5. checkout…"></a>1.5. checkout…</h4><h4 id="2-设置账户密码"><a href="#2-设置账户密码" class="headerlink" title="2. 设置账户密码"></a>2. 设置账户密码</h4><h4 id="2-1-引进配置文件shop-conf-svnserve-conf修改"><a href="#2-1-引进配置文件shop-conf-svnserve-conf修改" class="headerlink" title="2.1. 引进配置文件shop\conf\svnserve.conf修改"></a>2.1. 引进配置文件<strong>shop\conf\svnserve.conf</strong>修改</h4><h4 id="约20行-password-db-passwd-用户账户配置"><a href="#约20行-password-db-passwd-用户账户配置" class="headerlink" title="约20行 password-db = passwd 用户账户配置"></a>约20行 <strong>password-db = passwd</strong> 用户账户配置</h4><h4 id="约27行-authz-db-authz-权限配置"><a href="#约27行-authz-db-authz-权限配置" class="headerlink" title="约27行 authz-db = authz 权限配置"></a>约27行 <strong>authz-db = authz</strong> 权限配置</h4><h4 id="2-2-添加用户-gt-修改"><a href="#2-2-添加用户-gt-修改" class="headerlink" title="2.2. 添加用户-&gt;修改"></a>2.2. 添加用户-&gt;修改</h4><p><strong>/conf/passwd</strong></p>
<p>#添加用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[users]</span><br><span class="line"><span class="comment"># harry = harryssecret</span></span><br><span class="line"><span class="comment"># sally = sallyssecret</span></span><br><span class="line">a1 = 123</span><br><span class="line">a2 = 123</span><br></pre></td></tr></table></figure>



<h4 id="2-3-设置权限"><a href="#2-3-设置权限" class="headerlink" title="2.3. 设置权限"></a>2.3. 设置权限</h4><p>修改-&gt;<strong>conf/authz</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 给svn仓库的用户设置权限</span></span><br><span class="line"><span class="comment">#[/] 仓库的主机名地址 svn://localhost</span></span><br><span class="line"><span class="comment">#   运行仓库服务： svnserve -d -r f:/web/shop</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#[shop:/] 多个。。仓库的主机名地址 svn://localhost/shop</span></span><br><span class="line"><span class="comment">#   运行仓库服务： svnserve -d -r f:/web/</span></span><br><span class="line"><span class="comment">#具体权限 r：read 读 w：write 写</span></span><br><span class="line">[shop:/]</span><br><span class="line">a1 = rw</span><br><span class="line">a2 = r</span><br><span class="line">* =</span><br></pre></td></tr></table></figure>


<h4 id="2-4-svnserve-d-r-f-web"><a href="#2-4-svnserve-d-r-f-web" class="headerlink" title="2.4. svnserve -d -r f:\web"></a>2.4. svnserve -d -r f:\web</h4><blockquote>
<p>这里启动多个仓库，所以web，而不是web\shop</p>
</blockquote>
<h4 id="2-5-commit-or-checkout-，就要输入用户名和密码了额"><a href="#2-5-commit-or-checkout-，就要输入用户名和密码了额" class="headerlink" title="2.5. commit or checkout ，就要输入用户名和密码了额"></a>2.5. commit or checkout ，就要输入用户名和密码了额</h4><h5 id="2-6-多个用户时进行组别设置"><a href="#2-6-多个用户时进行组别设置" class="headerlink" title="2.6. 多个用户时进行组别设置"></a>2.6. 多个用户时进行组别设置</h5><p>约21-24行<br><code>bash
myusers = a1,a2,a3,a4,a5</code></p>
<p>#@符表示组，而不是普通用户例如 a1</p>
<p>#给组myusers 读写权限<br>@myusers = rw</p>
<img src="/p/e7812f0a/svn1.png" title="日志不正常">

<p>日志不正常。</p>
<blockquote>
<p>关掉匿名用户：shop\conf\svnserve.conf 约 12行<br><code>bash
anon-access = none</code></p>
</blockquote>
<p>然后就正常了。</p>
<img src="/p/e7812f0a/svn2.png" title="正常">
<h4 id="3-设置某个目录权限，只允许访问该目录"><a href="#3-设置某个目录权限，只允许访问该目录" class="headerlink" title="3. 设置某个目录权限，只允许访问该目录"></a>3. 设置某个目录权限，只允许访问该目录</h4><p>#设置某个目录权限<br>修改authz</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[shop:/waibao]</span><br><span class="line">w1 = rw</span><br><span class="line">w2 = rw</span><br><span class="line">w3 = rw</span><br><span class="line">* =</span><br></pre></td></tr></table></figure>

<p>保存后在用a1提交：</p>
<img src="/p/e7812f0a/svn3.png" title="提交">
<p>用w1提交：</p>
<img src="/p/e7812f0a/svn4.png" width="11">
<img src="/p/e7812f0a/svn5.png" width="22">
<h4 id="4-设置SVN开机启动"><a href="#4-设置SVN开机启动" class="headerlink" title="4. 设置SVN开机启动"></a>4. 设置SVN开机启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc create svnd binPath= <span class="string">"C:/Program Files (x86)/Subversion/bin/svnserve.exe -r f:/web/ --service"</span> start= auto </span><br><span class="line">binPath=空格 start=空格</span><br></pre></td></tr></table></figure>


<p>删除服务 <strong>sc delete svnd</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/6dd28e9b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/6dd28e9b/" itemprop="url">接口封装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-18T16:06:14+08:00">
                2015-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">CONST</span> TYPE = <span class="string">"json"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $code 状态码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $message 提示信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $data 数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $type 数据库类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($code, $message = <span class="string">''</span>, $data = array<span class="params">()</span>, $type = self::TYPE)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!is_numeric($code)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $result = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'code'</span> =&gt; $code,</span><br><span class="line">            <span class="string">'message'</span> =&gt; $message,</span><br><span class="line">            <span class="string">'data'</span> =&gt; $data</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($type == <span class="string">'json'</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>::json($code, $message, $data);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($type == <span class="string">'array'</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span> . print_r($result, <span class="number">1</span>) . <span class="string">"&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($type == <span class="string">'xml'</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>::xml($code, $message, $data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $data</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">json</span><span class="params">($code, $message = <span class="string">''</span>, $data = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!is_numeric($code)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $result = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'code'</span> =&gt; $code,</span><br><span class="line">            <span class="string">'message'</span> =&gt; $message,</span><br><span class="line">            <span class="string">'data'</span> =&gt; $data</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> json_encode($result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $data</span></span><br><span class="line"><span class="comment">     * return string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">xml</span><span class="params">($code, $message = <span class="string">''</span>, $data = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!is_numeric($code)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $result = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'code'</span> =&gt; $code,</span><br><span class="line">            <span class="string">'message'</span> =&gt; $message,</span><br><span class="line">            <span class="string">'data'</span> =&gt; $data</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        header(<span class="string">'Content-Type:text/xml'</span>);</span><br><span class="line">        $xml = <span class="string">"&lt;?xml version='1.0' encoding='UTF-8'?&gt;\n"</span>;</span><br><span class="line">        $xml .= <span class="string">"&lt;root&gt;"</span>;</span><br><span class="line">        $xml .= <span class="keyword">self</span>::xmlToEncode($result);</span><br><span class="line">        $xml .= <span class="string">"&lt;/root&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> $xml;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $result</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">xmlToEncode</span><span class="params">($result)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $xml = $attr = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_numeric($key)) &#123;</span><br><span class="line">                $attr = <span class="string">" id='"</span> . $key . <span class="string">"'"</span>;</span><br><span class="line">                $key = <span class="string">"item"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $xml .= <span class="string">"&lt;&#123;$key&#125;&#123;$attr&#125;&gt;"</span>;</span><br><span class="line">            $xml .= is_array($value) ? <span class="keyword">self</span>::xmlToEncode($value) : $value;</span><br><span class="line">            $xml .= <span class="string">"&lt;/&#123;$key&#125;&gt;\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $xml;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/5144b647/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/5144b647/" itemprop="url">mysql：连接PHP等基本操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-29T15:05:36+08:00">
                2015-11-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>基本流程：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 连接数据库： </span></span><br><span class="line">$mylink  =  mysql_connect(“localhost<span class="string">",  'root',  '123');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//2. 设定连接编码（通常是utf8）</span></span><br><span class="line"><span class="string">mysql_set_charset(“utf8"</span>);  <span class="comment">//也可以使用：mysql_query(“set names utf8");</span></span><br><span class="line">             </span><br><span class="line"><span class="comment">// 3. 选择数据库（如有需要）</span></span><br><span class="line">mysql_select_db(<span class="string">"数据库名"</span>); <span class="comment">//也可以使用：mysql_query("use  数据库名");</span></span><br><span class="line">         </span><br><span class="line"><span class="comment">// 4. 执行sql命令。 </span></span><br><span class="line">$result  =  mysql_query( <span class="string">"几乎任何sql语句"</span>);</span><br></pre></td></tr></table></figure>

<p>返回的结果通常需要分两种情形进行处理：</p>
<h5 id="如果是无返回数据的语句："><a href="#如果是无返回数据的语句：" class="headerlink" title="如果是无返回数据的语句："></a>如果是无返回数据的语句：</h5><h5 id="如果-result为true，表示执行成功"><a href="#如果-result为true，表示执行成功" class="headerlink" title="如果$result为true，表示执行成功"></a>如果$result为true，表示执行成功</h5><h5 id="如果-result为false，表示执行失败"><a href="#如果-result为false，表示执行失败" class="headerlink" title="如果$result为false，表示执行失败"></a>如果$result为false，表示执行失败</h5><h5 id="如果是有返回数据的语句："><a href="#如果是有返回数据的语句：" class="headerlink" title="如果是有返回数据的语句："></a>如果是有返回数据的语句：</h5><h5 id="如果-result为false，表示执行失败-1"><a href="#如果-result为false，表示执行失败-1" class="headerlink" title="如果$result为false，表示执行失败"></a>如果$result为false，表示执行失败</h5><h5 id="否则，执行成功，需要继续从结果中取出数据并显示出来。"><a href="#否则，执行成功，需要继续从结果中取出数据并显示出来。" class="headerlink" title="否则，执行成功，需要继续从结果中取出数据并显示出来。"></a>否则，执行成功，需要继续从结果中取出数据并显示出来。</h5><p>补充sql语句：<br>set names  gbk；<br>use 数据库名；<br>show  databases：<br>desc  表名：        显示一个表的“结构信息”，返回的其实也是结果集（类似select语句）<br>补充php操作mysql的函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$record  =  mysql_fetch_array( 结果集$result );</span><br><span class="line">$n1 = mysql_num_rows(  结果集$result ):  获取结果集的行数</span><br><span class="line">$n2 = mysql_num_fields(  结果集$result ):  获取结果集的列数</span><br><span class="line">mysql_field_name( 结果集$result， $i  ): 获取结果集中的第i个字段名（i从<span class="number">0</span>开始）</span><br></pre></td></tr></table></figure>


<p>细看今天的代码文件：《3php_mysql_base.php》</p>
<p>数据定义语句<br>数据库定义<br>语法形式<br>create  database  [if  not  exists ] 数据库名  [charset  字符集]  [collate  字符排序规则]；<br>说明：</p>
<blockquote>
<p>1，if  not  exists：用于判断是否存在该数据库名，如果存在则不执行该语句<br>2，字符集： 意图数据存储到本数据库中的时候所使用的字符编码名称，通常utf8，也可以gbk。<br>3，字符排序规则通常不设置，而是使用所设定的字符集的默认规则（每个字符集都有一个默认的排序规则）；<br>什么叫排序规则：设定一个字符集中的所有字符怎么排列先后顺序的规则。<br>“中”，“国”，“人”：</p>
</blockquote>
<p>举例：</p>
<p>显示mysql中的所有可用字符集：</p>
<p>显示mysql中的所有可用排序规则：</p>
<p>修改数据库：<br>alter database 数据库名 character set=新字符集 collate=新校对集;<br>删除数据库：<br>drop  database  数据库名；</p>
<p>其他数据库相关语句<br>选择（进入）某数据库：　　use  数据库名；<br>通常，要进行数据中的数据表和数据的操作，都必须先“进入”该数据库。</p>
<p>显示所有数据库：      show  databases;</p>
<p>显示某个数据库的“创建语句”：<br>show  create  database  数据库名；</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/1ad5be0d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/1ad5be0d/" itemprop="url">PHP开发中一些技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T17:56:44+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/" itemprop="url" rel="index">
                    <span itemprop="name">后端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/后端/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="1-让json-encode不转义斜杠"><a href="#1-让json-encode不转义斜杠" class="headerlink" title="1. 让json_encode不转义斜杠"></a>1. 让json_encode不转义斜杠</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> str_replace(<span class="string">"\\/"</span>, <span class="string">"/"</span>, json_encode(<span class="string">"2013/4/21"</span>));</span><br></pre></td></tr></table></figure>

<p>若是php版本是5.4的话</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> json_encode(<span class="string">"2011/7/11"</span>, JSON_UNESCAPED_SLASHES);</span><br></pre></td></tr></table></figure>

<h5 id="2-openssl生成证书server-key-server-crt"><a href="#2-openssl生成证书server-key-server-crt" class="headerlink" title="2. openssl生成证书server.key server.crt"></a>2. openssl生成证书server.key server.crt</h5><p>Key是私用秘钥，通常是RSA算法<br>Csr是证书请求文件，用于申请证书。在制作csr文件时，必须使用自己的私钥来签署申，还可以设定一个密钥。<br>crt是CA认证后的证书文，签署人用自己的key给你签署凭证。<br>key的生成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 2048</span><br></pre></td></tr></table></figure>

<p>这样是生成RSA密钥，openssl格式，2048位强度。server.key是密钥文件名。<br>csr的生成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key server.key -out server.csr</span><br></pre></td></tr></table></figure>

<p>需要依次输入国家，地区，组织，email。最重要的是有一个common name，可以写你的名字或者域名。如果为了https申请，这个<br>必须和域名吻合，否则会引发浏览器警报。生成的csr文件讲给CA签名后形成服务端自己的证书。<br>crt的生成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> server.csr -signkey server.key -out server.crt</span><br></pre></td></tr></table></figure>

<p>生成的server.crt文件</p>
<h5 id="3-获取程序开始执行的时间"><a href="#3-获取程序开始执行的时间" class="headerlink" title="3. 获取程序开始执行的时间"></a>3. 获取程序开始执行的时间</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$stime = microtime(<span class="keyword">true</span>); <span class="comment">#获取程序开始执行的时间</span></span><br><span class="line"><span class="comment">#你写的php代码</span></span><br><span class="line">$etime = microtime(<span class="keyword">true</span>); <span class="comment">#获取程序执行结束的时间</span></span><br><span class="line">$total = $etime - $stime;   <span class="comment">#计算差值</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br /&gt;&#123;$total&#125; times"</span>;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/p/2c7d08a0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿深">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/p/2c7d08a0/" itemprop="url">微信开放平台之公众号第三方平台探讨总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-26T16:32:15+08:00">
                2015-08-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/ThinkPHP/" itemprop="url" rel="index">
                    <span itemprop="name">ThinkPHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-申请地址：链接"><a href="#1-申请地址：链接" class="headerlink" title="1. 申请地址：链接"></a>1. 申请地址：<a href="https://open.weixin.qq.com/" target="_blank" rel="noopener">链接</a></h4><h4 id="2-填写开发资料："><a href="#2-填写开发资料：" class="headerlink" title="2. 填写开发资料："></a>2. 填写开发资料：</h4><img src="/p/2c7d08a0/wechat1.png" title="填写开发资料">


<p>说明：<strong>授权事件接收URL</strong>，用于获取微信服务器每10分钟推送的<strong>ComponentVerifyTicket</strong>，该Tikict用于和<strong>appid</strong>,<strong>appscret</strong>获取三方平台<br>的 <strong>component_access_token</strong>，而<strong>component_access_token</strong> 则用于获取预授权码<strong>pre_auth_code</strong>，授权码换取公众号的授权信，预授权码：<br>该API用于使用授权码换取授权公众号的授权信息，并换取<strong>authorizer_access_token</strong>和<strong>authorizer_refresh_token</strong>。 授权码的获取，需要<br>在用户在第三方平台授权页中完成授权流程后，在回调URI中通过URL参数提供给第三方平台方。授权成功会返回授权公众号的授权信息，值<br>得注意的是，<strong>authorizer_refresh_token</strong>必须保存好，<strong>authorizer_refresh_token</strong>是被授权公众号获取<strong>authorizer_access_token</strong><br>（相当于普通的<strong>access_token</strong>）的凭证，否则需要重新授权才能获取。</p>
<h4 id="3-配置"><a href="#3-配置" class="headerlink" title="3. 配置"></a>3. 配置</h4><p>如下：（注：所有消息收发均要加解密，主动调用的接口不包括）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sysmessage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    import(<span class="string">"@.ORG.aes.WXBizMsgCrypt"</span>);</span><br><span class="line">    $wxData = <span class="keyword">$this</span>-&gt;weixin_account;</span><br><span class="line">    $encodingAesKey = $wxData[<span class="string">'encodingAesKey'</span>];</span><br><span class="line">    $token = $wxData[<span class="string">'token'</span>];</span><br><span class="line">    $appId = $wxData[<span class="string">'appId'</span>];</span><br><span class="line">    $timeStamp = <span class="keyword">empty</span>($_GET[<span class="string">'timestamp'</span>]) ? <span class="string">""</span> : trim($_GET[<span class="string">'timestamp'</span>]);</span><br><span class="line">    $nonce = <span class="keyword">empty</span>($_GET[<span class="string">'nonce'</span>]) ? <span class="string">""</span> : trim($_GET[<span class="string">'nonce'</span>]);</span><br><span class="line">    $msg_sign = <span class="keyword">empty</span>($_GET[<span class="string">'msg_signature'</span>]) ? <span class="string">""</span> : trim($_GET[<span class="string">'msg_signature'</span>]);</span><br><span class="line">    $encryptMsg = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">    $pc = <span class="keyword">new</span> WXBizMsgCrypt($token, $encodingAesKey, $appId);</span><br><span class="line"></span><br><span class="line">    $xml_tree = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $xml_tree-&gt;loadXML($encryptMsg);</span><br><span class="line">    $array_e = $xml_tree-&gt;getElementsByTagName(<span class="string">'Encrypt'</span>);</span><br><span class="line">    $encrypt = $array_e-&gt;item(<span class="number">0</span>)-&gt;nodeValue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $format = <span class="string">"&lt;xml&gt;&lt;ToUserName&gt;&lt;![CDATA[toUser]]&gt;&lt;/ToUserName&gt;&lt;Encrypt&gt;&lt;![CDATA[%s]]&gt;&lt;/Encrypt&gt;&lt;/xml&gt;"</span>;</span><br><span class="line">    $from_xml = sprintf($format, $encrypt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第三方收到公众号平台发送的消息</span></span><br><span class="line">    $msg = <span class="string">''</span>;</span><br><span class="line">    $errCode = $pc-&gt;decryptMsg($msg_sign, $timeStamp, $nonce, $from_xml, $msg);</span><br><span class="line">    <span class="keyword">if</span> ($errCode == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//print("解密后: " . $msg . "\n");</span></span><br><span class="line">        $xml = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">        $xml-&gt;loadXML($msg);</span><br><span class="line">        $array_e = $xml-&gt;getElementsByTagName(<span class="string">'ComponentVerifyTicket'</span>);</span><br><span class="line">        $component_verify_ticket = $array_e-&gt;item(<span class="number">0</span>)-&gt;nodeValue;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//logResult('解密后的component_verify_ticket是：'.$component_verify_ticket);</span></span><br><span class="line"></span><br><span class="line">        $dateline = time();</span><br><span class="line">        $date_time = date(<span class="string">'Y-m-d H:i:s'</span>, time());</span><br><span class="line">        $data = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'component_verify_ticket'</span> =&gt; $component_verify_ticket,</span><br><span class="line">            <span class="string">'token_expires'</span> =&gt; $dateline + <span class="number">600</span>,</span><br><span class="line">            <span class="string">'date_time'</span> =&gt; $date_time,</span><br><span class="line">        );</span><br><span class="line">        $res = M(<span class="string">'weixin_account'</span>)-&gt;where(<span class="keyword">array</span>(<span class="string">'appId'</span> =&gt; <span class="keyword">$this</span>-&gt;component_appid))-&gt;save($data);</span><br><span class="line">        <span class="keyword">if</span> ($res) &#123;</span><br><span class="line">            $weixin_account = M(<span class="string">'weixin_account'</span>)-&gt;where(<span class="keyword">array</span>(<span class="string">'appId'</span> =&gt; <span class="keyword">$this</span>-&gt;component_appid))-&gt;find();</span><br><span class="line">            S(<span class="string">'weixin_account'</span> . <span class="keyword">$this</span>-&gt;component_appid, $weixin_account, <span class="number">600</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'success'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//logResult('解密后失败：'.$errCode);</span></span><br><span class="line">        <span class="comment">//$res = M('weixin_account')-&gt;where(array('appId'=&gt;$this-&gt;component_appid))-&gt;save(array('text'=&gt;'fasle'));</span></span><br><span class="line">        <span class="keyword">print</span>($errCode . <span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>获取授权跳转链接：</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取授权回调URL</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (IS_POST) &#123;</span><br><span class="line">        $pre_auth_code = <span class="keyword">$this</span>-&gt;weObj-&gt;get_auth_code();</span><br><span class="line">        $token = <span class="keyword">$this</span>-&gt;weObj-&gt;getAccessToken();</span><br><span class="line">        $callback = U(<span class="string">'Index/oauth_back'</span>, <span class="string">''</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">        $url = <span class="keyword">$this</span>-&gt;weObj-&gt;getRedirect($callback, $pre_auth_code);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ajaxReturn($url);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ajaxReturn(<span class="string">'error'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>格式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://mp.weixin.qq.com/cgi-bin/componentloginpage?component_appid=wx07068eax27ef6eed&amp;pre_auth_code=preauthcode@@@lVMrqq7UdbhIQj1-IwlrtYSXIoIghSSgPrWQmSgzSVChVdQJgJ2iAInQOqURpqFU&amp;redirect_uri=http%3A%2F%2Fsmg.xxx.cn%2Findex.php%3Fg%3DUser%26m%3DIndex%26a%3Doauth_back"</span> <span class="attr">id</span>=<span class="string">"authurl"</span> <span class="attr">style</span>=<span class="string">"display: inline;"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://open.weixin.qq.com/zh_CN/htmledition/res/assets/res-design-download/icon_button3_1.png" alt>
　　</p>
<p>点击进行授权：</p>
<img src="/p/2c7d08a0/wechat2.png" title="进行授权">

<p>再点击登陆并且授权的时候，会要求用管理员微信扫一扫确认授权。</p>
<p>授权成功后就得到被授权公众号的授权信息了，包括<strong>appId</strong>，<strong>authorizer_access_token</strong>，<strong>authorizer_refresh_token</strong>，<br>头像，公众号类型等信息，其中<strong>authorizer_refresh_token</strong>必须完整保存好。</p>
<p>这样就可以完成一个公众号的授权了。</p>
<h4 id="3-处理消息"><a href="#3-处理消息" class="headerlink" title="3. 处理消息"></a>3. 处理消息</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//公众号消息与事件接收URL</span></span><br><span class="line"><span class="comment">//此处为示例，逻辑需要自己处理，（注意加解密）</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eventmsg</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    import(<span class="string">"@.ORG.aes.WXBizMsgCrypt"</span>);</span><br><span class="line">    $wxData = <span class="keyword">$this</span>-&gt;weixin_account;</span><br><span class="line">    $encodingAesKey = $wxData[<span class="string">'encodingAesKey'</span>];</span><br><span class="line">    $token = $wxData[<span class="string">'token'</span>];</span><br><span class="line">    $appId = $wxData[<span class="string">'appId'</span>];</span><br><span class="line">    $timeStamp = <span class="keyword">empty</span>($_GET[<span class="string">'timestamp'</span>]) ? <span class="string">""</span> : trim($_GET[<span class="string">'timestamp'</span>]);</span><br><span class="line">    $nonce = <span class="keyword">empty</span>($_GET[<span class="string">'nonce'</span>]) ? <span class="string">""</span> : trim($_GET[<span class="string">'nonce'</span>]);</span><br><span class="line">    $msg_sign = <span class="keyword">empty</span>($_GET[<span class="string">'msg_signature'</span>]) ? <span class="string">""</span> : trim($_GET[<span class="string">'msg_signature'</span>]);</span><br><span class="line"></span><br><span class="line">    $encryptMsg = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">    $pc = <span class="keyword">new</span> WXBizMsgCrypt($token, $encodingAesKey, $appId);</span><br><span class="line"></span><br><span class="line">    $xml_tree = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $xml_tree-&gt;loadXML($encryptMsg);</span><br><span class="line">    $array_e = $xml_tree-&gt;getElementsByTagName(<span class="string">'Encrypt'</span>);</span><br><span class="line">    $encrypt = $array_e-&gt;item(<span class="number">0</span>)-&gt;nodeValue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $format = <span class="string">"&lt;xml&gt;&lt;ToUserName&gt;&lt;![CDATA[toUser]]&gt;&lt;/ToUserName&gt;&lt;Encrypt&gt;&lt;![CDATA[%s]]&gt;&lt;/Encrypt&gt;&lt;/xml&gt;"</span>;</span><br><span class="line">    $from_xml = sprintf($format, $encrypt);</span><br><span class="line">    <span class="comment">// 第三方收到公众号平台发送的消息</span></span><br><span class="line">    $msg = <span class="string">''</span>;</span><br><span class="line">    $errCode = $pc-&gt;decryptMsg($msg_sign, $timeStamp, $nonce, $from_xml, $msg);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($errCode == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//print("解密后: " . $msg . "\n");</span></span><br><span class="line">        $xml = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">        $xml-&gt;loadXML($msg);</span><br><span class="line"></span><br><span class="line">        $array_e = $xml-&gt;getElementsByTagName(<span class="string">'Content'</span>);</span><br><span class="line">        $content = $array_e-&gt;item(<span class="number">0</span>)-&gt;nodeValue;</span><br><span class="line"></span><br><span class="line">        $array_e2 = $xml-&gt;getElementsByTagName(<span class="string">'ToUserName'</span>);</span><br><span class="line">        $ToUserName = $array_e2-&gt;item(<span class="number">0</span>)-&gt;nodeValue;</span><br><span class="line"></span><br><span class="line">        $array_e3 = $xml-&gt;getElementsByTagName(<span class="string">'FromUserName'</span>);</span><br><span class="line">        $FromUserName = $array_e3-&gt;item(<span class="number">0</span>)-&gt;nodeValue;</span><br><span class="line"></span><br><span class="line">        $array_e5 = $xml-&gt;getElementsByTagName(<span class="string">'MsgType'</span>);</span><br><span class="line">        $MsgType = $array_e5-&gt;item(<span class="number">0</span>)-&gt;nodeValue;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//加密消息</span></span><br><span class="line">        $encryptMsg = <span class="string">''</span>;</span><br><span class="line">        $text = <span class="string">"&lt;xml&gt;</span></span><br><span class="line"><span class="string">					&lt;ToUserName&gt;&lt;![CDATA[$FromUserName]]&gt;&lt;/ToUserName&gt;</span></span><br><span class="line"><span class="string">					&lt;FromUserName&gt;&lt;![CDATA[$ToUserName]]&gt;&lt;/FromUserName&gt;</span></span><br><span class="line"><span class="string">					&lt;CreateTime&gt;$stime&lt;/CreateTime&gt;</span></span><br><span class="line"><span class="string">					&lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;</span></span><br><span class="line"><span class="string">					&lt;Content&gt;&lt;![CDATA[$contentx]]&gt;&lt;/Content&gt;</span></span><br><span class="line"><span class="string">					&lt;/xml&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        $errCode = $pc-&gt;encryptMsg($text, $timeStamp, $nonce, $encryptMsg);</span><br><span class="line">        <span class="keyword">echo</span> $encryptMsg;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">print</span>($errCode . <span class="string">"\n"</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">```   </span><br><span class="line">　　到此授权基本完成了。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">#### 4. 全网发布检测 ####</span></span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line"><span class="keyword">if</span> ($MsgType == <span class="string">"text"</span>) &#123;</span><br><span class="line">    $needle = <span class="string">'QUERY_AUTH_CODE:'</span>;</span><br><span class="line">    $tmparray = explode($needle, $content);</span><br><span class="line">    <span class="keyword">if</span> (count($tmparray) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//3、模拟粉丝发送文本消息给专用测试公众号，第三方平台方需在5秒内返回空串</span></span><br><span class="line">        <span class="comment">//表明暂时不回复，然后再立即使用客服消息接口发送消息回复粉丝                                </span></span><br><span class="line">        $contentx = str_replace($needle, <span class="string">''</span>, $content);</span><br><span class="line">        $info = <span class="keyword">$this</span>-&gt;weObj-&gt;get_authorization_info($contentx);</span><br><span class="line">        $test_token = $info[<span class="string">'authorizer_access_token'</span>];</span><br><span class="line">        $content_re = $contentx . <span class="string">"_from_api"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">''</span>;</span><br><span class="line">        $data = <span class="string">'&#123;</span></span><br><span class="line"><span class="string">                            "touser":"'</span> . $FromUserName . <span class="string">'",</span></span><br><span class="line"><span class="string">                            "msgtype":"text",</span></span><br><span class="line"><span class="string">                            "text":</span></span><br><span class="line"><span class="string">                            &#123;</span></span><br><span class="line"><span class="string">                                 "content":"'</span> . $content_re . <span class="string">'"</span></span><br><span class="line"><span class="string">                            &#125;</span></span><br><span class="line"><span class="string">                        &#125;'</span>;</span><br><span class="line">        $url = <span class="string">"https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token="</span> . $test_token;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;https_post($url, $data);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//2、模拟粉丝发送文本消息给专用测试公众号</span></span><br><span class="line">        $contentx = <span class="string">"TESTCOMPONENT_MSG_TYPE_TEXT_callback"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1、模拟粉丝触发专用测试公众号的事件</span></span><br><span class="line"><span class="keyword">if</span> ($MsgType == <span class="string">"event"</span>) &#123;</span><br><span class="line">    $array_e4 = $xml-&gt;getElementsByTagName(<span class="string">'Event'</span>);</span><br><span class="line">    $event = $array_e4-&gt;item(<span class="number">0</span>)-&gt;nodeValue;</span><br><span class="line">    $contentx = $event . <span class="string">"from_callback"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>效果：</p>
<img src="/p/2c7d08a0/wechat3.png" title="效果">

<p>检测</p>
<img src="/p/2c7d08a0/wechat4.png" title="检测">

<p>成功</p>
<img src="/p/2c7d08a0/wechat5.png" title="成功">

<p>到此<strong>全网发布</strong>完成</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/head3.jpg" alt="阿深">
            
              <p class="site-author-name" itemprop="name">阿深</p>
              <p class="site-description motion-element" itemprop="description">阿深</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿深</span>

  
  <a href="http://www.beian.miit.gov.cn">粤ICP备15053509号</a>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
