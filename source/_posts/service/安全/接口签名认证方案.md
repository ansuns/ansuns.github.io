---
title: 接口签名认证方案
abbrlink: 3074e1a6
date: 2019-08-15 23:22:45
tags:
  - 部署
  - 接口验证
  - 算法
categories:
  - 服务
  - 部署
---

针对近期在一些红包、抽奖、投票活动中，有些人利用技术手段和批量账号，参与活动刷取利益的行为，我们需要从业务和技术层面都提
高警惕，在业务流程设计和技术架构设计上建立应对机制和优化措施。有数据表明，国内目前的“羊毛党”、黑产从业者，有20万人之多，所以
这种攻防对战会一直存在。除了业务活动设计者在上这类活动时要非常慎重之外，我们技术也需在接口安全方面做相应解决方案。为了保证
客户端与服务器端接口通信安全，防止接口被非法请求或篡改数据现设计如下解决方案。


主要目标：
> - 1、验证请求来源是否合法问题。
> - 2、防止请求参数被篡改问题。
> - 3、验证请求的唯一性，不可复制。

主要算法思路：
> - 1、算法选择：选用对称加密算法**sha-1**或**md5**；非对称加密相比对称加密更加安全，但缺点就是耗CPU资源，耗电。所以在此采用对称加密算法md5，加密效率高。
> - 2、客户端和服务器端双方选择同一种加密模式，对传输的数据进行加密，再用参数字段进行数字签名，双方对签名比较验证，这样可确认请求者身份的合法性，也防止数据被篡改；
> - 3、同时，在请求参数中，我们加入时间戳，也把时间戳作为请求参数之一加入**sign**算法中进行加密，服务器端通过比较时间有效期，确定是否失效，这样我们可以保证请求的唯一性。
> - 4、关于客户端密钥保存问题，主要考虑采用代码混淆、加壳加密、定期更换的方式。
> - 5、**sign** **签名**的生成规则：接口中的所有参数,包括key和Ts，去除掉参数中值为空的参数后，按照参数key值排序，用&链接，并全部转化为小写，然后用MD5加密。
> - 6、给不同客户端或第三方分配不同的密钥key、serect，以便管理。切勿在参数中带serect.
> - 7、接口请求格式：http://xxx/getName?key=app_key&sign=BC671B701D8A35...&ts=201506261407&p1=value1&p2=value2。

实施步骤：
我们先在红包、抽奖、投票和注册登录等涉及利益的接口中加入**接口认证**机制，防止非正常请求操作成功，这样牟利的人无利可图，可大幅降低
攻击风险和攻击流量，即使还有流量负载压力，那我们可以采用常规的应用负载均衡部署和网络过滤方式解决，这些都有成熟解决方案，不属于
本方案范畴，我们可另行规划讨论。

另外，关于利用同一台设备刷注册量这类问题，我们需考虑逐步建立一套用户行为分析系统。初期我们可以先收集一些用户基本信息，如采集记录设备识别码、ip、手机号、帐号、登录时间等，然后在某些场景中利用这些行为记录做相应的规则匹配，输出相应的业务决策。比如某台设备码在一天内注册或登录超过N次后，返回验证码登录、设备锁定提示等。
> - 1、在客户端请求某些关键接口时，采集相应信息传输给服务器端，服务器端异步存储用户行为记录。
> - 2、在需要验证用户行为的业务逻辑中，调用用户行为分析接口，形成决策，比如拒绝请求、要求登录认证、验证码验证、短信验证等。
> - 3、建立通用的短信验证码接口、图形验证码接口，在关键活动中接入验证环节。
> - 4、我们也可关注一些专业的第三方防刷服务，如腾讯云的天御业务安全防护、活动防刷服务。